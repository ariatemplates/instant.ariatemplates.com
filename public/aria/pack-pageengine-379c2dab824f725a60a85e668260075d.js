/*
 * Aria Templates 1.4.4 - 22 May 2013
 *
 * Copyright 2009-2013 Amadeus s.a.s.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//***MULTI-PART
//*******************
//LOGICAL-PATH:aria/pageEngine/CfgBeans.js
//*******************
Aria.beanDefinitions({$package:"aria.pageEngine.CfgBeans",$namespaces:{json:"aria.core.JsonTypes",core:"aria.core.CfgBeans"},$beans:{ExtendedCallback:{$type:"json:Object",$properties:{onsuccess:{$type:"core:Callback"},onfailure:{$type:"core:Callback"}}},Start:{$type:"json:Object",$properties:{pageProvder:{$type:"json:Object",$mandatory:!0},onerror:{$type:"core:Callback"},oncomplete:{$type:"core:Callback"}}},Site:{$type:"json:Object",$restricted:!1,$properties:{containerId:{$type:"json:String",$mandatory:!0},commonModules:{$type:"json:Map",$contentType:{$type:"CommonModule"},$default:{}},appData:{$type:"json:Map",$contentType:{$type:"json:MultiTypes"},$default:{}},contentProcessors:{$type:"json:Map",$contentType:{$type:"json:PackageName"},$default:{}},navigation:{$type:"json:Enum",$enumValues:["history","hash"]},animations:{$type:"json:Boolean",$default:!1},css:{$type:"json:Array",$contentType:{$type:"json:String"}}}},PageRequest:{$type:"json:Object",$restricted:!1,$properties:{pageId:{$type:"json:String"},url:{$type:"json:String"}}},PageNavigationInformation:{$type:"PageRequest",$restricted:!1,$properties:{replace:{$type:"json:Boolean"},title:{$type:"json:String"},data:{$type:"json:Object"},forceReload:{$type:"json:Boolean"}}},PageDefinition:{$type:"json:Object",$restricted:!1,$properties:{contents:{$type:"PageContents",$mandatory:!0},pageComposition:{$type:"PageComposition",$mandatory:!0},pageId:{$type:"json:String",$mandatory:!0},url:{$type:"json:String"},title:{$type:"json:String"},animation:{$type:"PageAnimation"}}},PageContents:{$type:"json:Object",$properties:{menus:{$type:"json:Map",$keyType:{$type:"json:String"},$contentType:{$type:"json:Object",$restricted:!1}},placeholderContents:{$type:"json:Map",$keyType:{$type:"json:String"},$contentType:{$type:"Content"}}}},PageComposition:{$type:"json:Object",$properties:{template:{$type:"json:String",$mandatory:!0},pageData:{$type:"json:Object",$restricted:!1,$default:{}},modules:{$type:"json:Map",$contentType:{$type:"Module"},$default:{}},placeholders:{$type:"json:Map",$keyType:{$type:"json:String",$sample:"body.top"},$contentType:{$type:"Placeholder"},$mandatory:!0},css:{$type:"json:Array",$contentType:{$type:"json:String"}}}},PageAnimation:{$type:"json:Object",$properties:{animateOut:{$type:"json:Enum",$sample:"slide left",$enumValues:["slide left","slide right","slide up","slide down","fade","fade reverse","pop","pop reverse","flip","flip reverse"]},animateIn:{$type:"json:Enum",$sample:"slide left",$enumValues:["slide left","slide right","slide up","slide down","fade","fade reverse","pop","pop reverse","flip","flip reverse"],$mandatory:!0}}},Placeholder:{$type:"json:MultiTypes",$contentTypes:[{$type:"json:String"},{$type:"json:Object",$properties:{template:{$type:"json:String"},contentId:{$type:"json:String"},module:{$type:"json:String"},data:{$type:"json:Object"},args:{$type:"json:Array",$contentType:{$type:"json:MultiTypes"}},css:{$type:"json:Array",$contentType:{$type:"json:String"}}}},{$type:"json:Array",$contentType:{$type:"Placeholder"}}]},Module:{$type:"json:Object",$properties:{classpath:{$type:"json:PackageName",$mandatory:!0},initArgs:{$type:"json:ObjectRef"},bind:{$type:"json:ObjectRef"}}},CommonModule:{$type:"Module",$properties:{priority:{$type:"json:Integer",$default:1,$minValue:1,$maxValue:2}}},Content:{$type:"json:Object",$properties:{value:{$type:"json:String",$mandatory:!0},contentType:{$type:"json:String"}}}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/PageEngineInterface.js
//*******************
Aria.interfaceDefinition({$classpath:"aria.pageEngine.PageEngineInterface",$events:{pageReady:""},$interface:{navigate:{$type:"Function",$callbackParam:1},getData:{$type:"Function"},getPageProvider:{$type:"Function"},isModuleInPage:{$type:"Function"}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/SiteRootModuleInterface.js
//*******************
Aria.interfaceDefinition({$classpath:"aria.pageEngine.SiteRootModuleInterface",$extends:"aria.templates.IModuleCtrl",$events:{pageReady:""},$interface:{getPageModule:{$type:"Function"},loadModules:{$type:"Function",$callbackParam:2},unloadCommonModules:{$type:"Function"},unloadPageModules:{$type:"Function"},unloadAllModules:{$type:"Function"},navigate:{$type:"Function"}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/PageEngineUtils.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.utils.PageEngineUtils",$singleton:!0,$dependencies:["aria.utils.Array","aria.utils.Path"],$prototype:{addIfMissing:function(e,t){e&&!aria.utils.Array.contains(t,e)&&t.push(e)},wiseConcat:function(e,t){for(var i,r=0,s=t.length;s>r;r++)i=t[r],this.addIfMissing(i,e)},extractPropertyFromArrayElements:function(e,t){for(var i,r=[],s=0,a=e.length;a>s;s++)i=e[s],i[t]&&r.push(i[t]);return r},addKeyAsProperty:function(e,t){for(var i in e)e.hasOwnProperty(i)&&(e[i][t]=i)},resolvePath:function(e,t){var i;try{i=aria.utils.Path.resolve(e,t)}catch(r){i=void 0}return i},logMultipleErrors:function(e,t,i){i.$logError.apply(i,[e+":"]);for(var r=0,s=t.length;s>r;r++)i.$logError.apply(i,[r+1+" - "+t[r].msgId,t[r].msgArgs])}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/SiteRootModule.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.SiteRootModule",$extends:"aria.templates.ModuleCtrl",$implements:["aria.pageEngine.SiteRootModuleInterface"],$dependencies:["aria.utils.Path","aria.pageEngine.utils.PageEngineUtils"],$constructor:function(){this._enableMethodEvents=!1,this.$ModuleCtrl.constructor.call(this),this.commonModules={},this.pageModules={},this._modulesPaths={common:[],page:{}},this._utils=aria.pageEngine.utils.PageEngineUtils,this._pathUtils=aria.utils.Path,this._bindings={},this._pageEngine=null},$destructor:function(){this.json.removeListener(this._data,"storage",{fn:this._updateModulesData,scope:this},!0),this.unloadAllModules(),this._data=null,this.commonModules=null,this.pageModules=null,this.$ModuleCtrl.$destructor.call(this)},$prototype:{$publicInterfaceName:"aria.pageEngine.SiteRootModuleInterface",init:function(e,t){this._data={storage:{appData:e.appData,pageData:{}}},this.json.addListener(this._data,"storage",{fn:this._updateModulesData,scope:this},!1,!0),this._pageEngine=e.pageEngine,this.$callback(t)},onSubModuleEvent:function(e){"navigate"==e.name&&this._pageEngine.navigate(e.page)},navigate:function(e){this._pageEngine.navigate(e)},getPageModule:function(e,t){var i=-1!=t.indexOf("common:"),r=this.buildModuleRefpath(t.replace(/^common:/,""),i,e);return this._utils.resolvePath(r,this)},buildModuleRefpath:function(e,t,i){return t?"commonModules."+e:"pageModules."+i+"."+e},loadModules:function(e,t,i){for(var r,s,a,n,o=[],l=[],c=[{modules:t.page,isCommon:!1},{modules:t.common,isCommon:!0}],h=0;2>h;h++){r=c[h].modules,a=c[h].isCommon;for(var u=0,p=r.length;p>u;u+=1)s=this.buildModuleRefpath(r[u].refpath,a,e),null==this._utils.resolvePath(s,this)&&(n=aria.utils.Json.copy(r[u]),n.refpath=s,o.push({classpath:n.classpath,initArgs:this._injectPageEngine(n.initArgs),refpath:s}),l.push(n),this._addRefpath(e,a,s))}this.loadSubModules(o,{fn:this.connectBindings,scope:this,resIndex:-1,args:{pageId:e,callback:i,modules:l}})},_injectPageEngine:function(e){return e=e||{},e.pageEngine=this._pageEngine,e},_unloadModules:function(e){for(var t,i=0,r=e.length;r>i;i++)t=e[i],this._disconnectModuleBindings(t),this.disposeSubModule(this._utils.resolvePath(t,this))},unloadCommonModules:function(){var e=this._modulesPaths.common||[];this._unloadModules(e),this._modulesPaths.common=[]},unloadPageModules:function(e){var t=e&&this._modulesPaths.page[e]?this._modulesPaths.page[e]:[];this._unloadModules(t),delete this._modulesPaths.page[e]},unloadAllModules:function(){this.unloadCommonModules();var e=this._modulesPaths.page;for(var t in e)e.hasOwnProperty(t)&&this.unloadPageModules(t)},_addRefpath:function(e,t,i){var r=this._modulesPaths;return t?(r.common.push(i),void 0):(r.page[e]=r.page[e]||[],r.page[e].push(i),void 0)},connectBindings:function(e){for(var t=e.modules,i=0;t.length>i;i+=1){var r=t[i].bind,s=t[i].refpath;if(r)for(var a in r)if(r.hasOwnProperty(a)&&!this.json.isMetadata(a)){var n=this._getStorage(r[a]);if(n){var o=this._getModuleDataDescription(s,a);this.$assert(2,!!o);var l={fn:this._bindModuleChange,scope:this,args:{boundTo:n,moduleDescription:o}};this.json.addListener(o.container,o.property,l,!1,!0),this._bindings[s]=this._bindings[s]||{},this._bindings[s][a]=[r[a],l]}}}this._updateModulesData(),this.$callback(e.callback,e.callback.args)},disconnectBindings:function(e){if(e)for(var t=0,i=e.length;i>t;t++)this._disconnectModuleBindings(e[t]);else{this.disconnectBindings(this._modulesPaths.common);var r=this._modulesPaths.page;for(var s in r)r.hasOwnProperty(s)&&this.disconnectBindings(r[s])}},_disconnectModuleBindings:function(e){var t=this._bindings[e];if(t){for(var i in t)if(t.hasOwnProperty(i)){var r=this._getModuleDataDescription(e,i);this.json.removeListener(r.container,r.property,t[i][1],!0)}delete this._bindings[e]}},_updateModulesData:function(){var e=this._bindings;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];for(var r in i)if(i.hasOwnProperty(r)){var s=this._getModuleDataDescription(t,r),a=this._getStorage(i[r][0]),n=this._utils.resolvePath(a.path,a.storage);this.json.setValue(s.container,s.property,n,i[r][1])}}},_getModuleDataDescription:function(e,t){var i=this._utils.resolvePath(e,this._data);return this._utils.resolvePath(t,i)||this._pathUtils.setValue(i,t,null),this._pathUtils.describe(i,t)},_getStorage:function(e){var t=e.split(":");if(2>t.length)return null;var i=this._data.storage[t[0]];return i?(t.splice(0,1),{storage:i,path:t.join(":")}):null},_bindModuleChange:function(e,t){var i=t.moduleDescription.container[t.moduleDescription.property],r=t.boundTo;null==this._utils.resolvePath(r.path,r.storage)&&this._pathUtils.setValue(r.storage,r.path,null);var s=this._pathUtils.describe(r.storage,r.path);this.json.setValue(s.container,s.property,i)}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/SiteConfigHelper.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.utils.SiteConfigHelper",$dependencies:["aria.utils.Dom","aria.pageEngine.utils.PageEngineUtils","aria.utils.Array"],$constructor:function(e){this.siteConfig=e,this._contentProcessorsInstances={},aria.pageEngine.utils.PageEngineUtils.addKeyAsProperty(this.siteConfig.commonModules,"refpath")},$destructor:function(){this.disposeContentProcessorsInstances()},$statics:{MISSING_PROCESS_METHOD:"The processContent method is not implemented"},$prototype:{getRootDiv:function(){var e=this.getRootDivId(),t=aria.utils.Dom.getElementById(e);return t||(t=Aria.$window.document.createElement("DIV"),t.id=e,Aria.$window.document.body.appendChild(t)),t},getRootDivId:function(){return this.siteConfig.containerId},getAppData:function(){return this.siteConfig.appData},getListOfContentProcessors:function(){var e=[];for(var t in this.siteConfig.contentProcessors)this.siteConfig.contentProcessors.hasOwnProperty(t)&&e.push(this.siteConfig.contentProcessors[t]);return e},getContentProcessorInstances:function(){var e={},t=aria.utils.Type;for(var i in this.siteConfig.contentProcessors)if(this.siteConfig.contentProcessors.hasOwnProperty(i)){var r=Aria.getClassRef(this.siteConfig.contentProcessors[i]),s=t.isFunction(r)?new r:r;s.processContent?e[i]=s:this.$logError(this.MISSING_PROCESS_METHOD,this.siteConfig.contentProcessors[i])}return this._contentProcessorsInstances=e,e},disposeContentProcessorsInstances:function(){var e=aria.utils.Type,t=this._contentProcessorsInstances;for(var i in t)if(t.hasOwnProperty(i)){var r=Aria.getClassRef(this.siteConfig.contentProcessors[i]);e.isFunction(r)&&t[i].$dispose()}},getCommonModulesDescription:function(e){var t=this.siteConfig.commonModules;if(!e)return aria.utils.Array.extractValuesFromMap(t);var i,r=e.priority,s=e.refpaths,a=[];if(s){for(var n=0,o=s.length;o>n;n++)i=t[s[n]],!i||r&&r!=i.priority||a.push(i);return a}for(var l in t)t.hasOwnProperty(l)&&(i=t[l],r&&r!=i.priority||a.push(i));return a},getNavigationManagerClass:function(){var e=this.siteConfig.navigation;if(e){if("history"==e)return"aria.pageEngine.utils.HistoryManager";if("hash"==e)return"aria.pageEngine.utils.HashManager"}return null},getNavigationManager:function(e){var t=this.siteConfig.navigation;if(t){if("history"==t)return new aria.pageEngine.utils.HistoryManager(e);if("hash"==t)return new aria.pageEngine.utils.HashManager(e)}return null},getSiteCss:function(){return this.siteConfig.css||[]}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/PageConfigHelper.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.utils.PageConfigHelper",$dependencies:["aria.pageEngine.utils.PageEngineUtils","aria.utils.Type","aria.utils.Array"],$constructor:function(e){this._pageConfig=e,this._utils=aria.pageEngine.utils.PageEngineUtils,this._utils.addKeyAsProperty(this._pageConfig.pageComposition.modules,"refpath")},$prototype:{getMenus:function(){return this._pageConfig.contents.menus},getPageDependencies:function(e){var t={templates:[],classes:[],modules:{page:[],common:[]},css:[]},i=this._pageConfig.pageComposition,r=i.placeholders||{},s=aria.utils.Type;e||(this._utils.addIfMissing(i.template,t.templates),i.css&&(t.css=i.css.slice(0)));for(var a in r)if(r.hasOwnProperty(a)){var n=r[a];s.isArray(n)||(n=[n]);for(var o=0;n.length>o;o+=1)this._addPlaceholderDependencies(n[o],t,e)}return t},_addPlaceholderDependencies:function(e,t,i){var r,s,a=this._pageConfig.pageComposition.modules||{},n=aria.utils.Type;if(n.isObject(e)){var o=e.lazy;i&&!o||!i&&o||("module"in e&&(r=e.module,r.match(/^common:/)?this._utils.addIfMissing(r.replace(/^common:/,""),t.modules.common):(s=a[r],s&&(this._utils.addIfMissing(s.classpath,t.classes),this._utils.addIfMissing(r,t.modules.page)))),"template"in e&&this._utils.addIfMissing(e.template,t.templates),"css"in e&&this._utils.wiseConcat(t.css,e.css))}},getPageModulesDescriptions:function(e){var t,i,r,s=this._pageConfig.pageComposition.modules||{},a=[];if(e){for(t=0,i=e.length;i>t;t++)r=s[e[t]],r&&a.push(r);return a}return aria.utils.Array.extractValuesFromMap(s)},getLazyPlaceholdersIds:function(){var e,t=[],i=aria.utils.Type,r=this._pageConfig.pageComposition.placeholders||{};for(var s in r)if(r.hasOwnProperty(s)){e=!1;var a=r[s];i.isArray(a)||(a=[a]);for(var n=0;a.length>n;n+=1)a[n].lazy&&(e=!0);e&&t.push(s)}return t}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/PageEngine.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.PageEngine",$implements:["aria.embed.IContentProvider","aria.pageEngine.PageEngineInterface"],$dependencies:["aria.pageEngine.CfgBeans","aria.pageEngine.SiteRootModule","aria.templates.ModuleCtrlFactory","aria.core.JsonValidator","aria.pageEngine.utils.SiteConfigHelper","aria.pageEngine.utils.PageConfigHelper","aria.embed.PlaceholderManager","aria.utils.Type","aria.pageEngine.utils.PageEngineUtils","aria.utils.CSSLoader","aria.utils.Json","aria.core.Browser"],$constructor:function(){this._config=null,this._pageProvider=null,this._navigationManager=null;var e=aria.core.Browser;this._animationsDisabled=e.isIE&&10>e.majorVersion||e.isFirefox&&4>e.majorVersion,this._animationsManager=null,this._siteConfigHelper=null,this._rootModule=null,this._pageConfigs={},this._currentPageCSS=[],this._previousPageCSS=[],this.contentProcessors={},this._dependenciesLoader=null,this.currentPageId=null,this._utils=aria.pageEngine.utils.PageEngineUtils,this._wrapper=this.$interface("aria.pageEngine.PageEngineInterface"),this._isTemplateLoaded=!1,this._activeDiv=1,this._firstDiv=null,this._secondDiv=null,this._data={},this._modulesInPage=[],this._onPageDefinitionChangeListener={fn:this._onPageDefinitionChange,scope:this}},$destructor:function(){aria.embed.PlaceholderManager.unregister(this),this._navigationManager&&this._navigationManager.$dispose(),this._isTemplateLoaded&&Aria.disposeTemplate(this._getContainer()),this._animationsManager&&this._animationsManager.$dispose(),this._firstDiv=null,this._secondDiv&&(this._secondDiv.parentNode.removeChild(this._secondDiv),this._secondDiv=null);var e=this._siteConfigHelper,t=aria.utils.CSSLoader;e&&(t.remove(e.getSiteCss()),e.$dispose()),t.remove(this._previousPageCSS),t.remove(this._currentPageCSS),this._modulesInPage=null,this._rootModule&&(this._rootModule.$dispose(),this._rootModule=null),this._pageProvider.$removeListeners({pageDefinitionChange:this._onPageDefinitionChangeListener}),this._onPageDefinitionChangeListener=null},$statics:{SITE_CONFIG_NOT_AVAILABLE:"Unable to retrieve the site configuration",INVALID_SITE_CONFIGURATION:"The configuration object of the application is not valid",PAGE_NOT_AVAILABLE:"Unable to retrieve page %1",INVALID_PAGE_DEFINITION:"The page definition does not match the bean aria.pageEngine.CfgBeans.PageDefinition",MISSING_DEPENDENCIES:"Unable to download Page Engine dependencies"},$prototype:{start:function(e){this._config=e,this._pageProvider=e.pageProvider,aria.embed.PlaceholderManager.register(this),this._pageProvider.$addListeners({pageDefinitionChange:this._onPageDefinitionChangeListener}),this._pageProvider.loadSiteConfig({onsuccess:{fn:this._loadRootModule,scope:this},onfailure:{fn:this._errorCallback,scope:this,args:[this.SITE_CONFIG_NOT_AVAILABLE],resIndex:-1}})},_loadRootModule:function(e){var t=this.isConfigValid(e,"aria.pageEngine.CfgBeans.Site",this.INVALID_SITE_CONFIGURATION);if(t){var i=new aria.pageEngine.utils.SiteConfigHelper(e);this._siteConfigHelper=i;var s=i.getAppData();s.menus=s.menus||{},aria.templates.ModuleCtrlFactory.createModuleCtrl({classpath:"aria.pageEngine.SiteRootModule",initArgs:{appData:i.getAppData(),pageEngine:this._wrapper}},{fn:this._loadSiteDependencies,scope:this})}},_loadSiteDependencies:function(e){this._rootModule=e.moduleCtrlPrivate,this._data=this._rootModule.getData().storage;var t=this._siteConfigHelper;aria.utils.CSSLoader.add(t.getSiteCss());var i=t.getListOfContentProcessors(),s=t.getNavigationManagerClass();s&&i.push(s),t.siteConfig.animations&&i.push("aria.pageEngine.utils.AnimationsManager");var r=t.getCommonModulesDescription({priority:1});this._utils.wiseConcat(i,this._utils.extractPropertyFromArrayElements(r,"classpath")),Aria.load({classes:i,oncomplete:{fn:this._loadGlobalModules,scope:this,args:r},onerror:{fn:this._errorCallback,scope:this,args:[this.MISSING_DEPENDENCIES],resIndex:-1}})},_loadGlobalModules:function(e){this._rootModule.loadModules(null,{page:[],common:e},{fn:this._onSiteReady,scope:this})},_onSiteReady:function(){this._siteConfigHelper,this.contentProcessors=this._siteConfigHelper.getContentProcessorInstances(),this._firstDiv=this._siteConfigHelper.getRootDiv(),!this._animationsDisabled&&this._siteConfigHelper.siteConfig.animations&&(this._animationsManager=new aria.pageEngine.utils.AnimationsManager,this._secondDiv=this._animationsManager.createHiddenDiv(this._firstDiv)),this._navigationManager=this._siteConfigHelper.getNavigationManager({fn:"navigate",scope:this}),this.navigate({url:this._navigationManager?this._navigationManager.getUrl():null,pageId:this._navigationManager?this._navigationManager.getPageId():null,replace:!0},this._config.oncomplete)},navigate:function(e,t){var i=e.pageId,s=e.forceReload;!s&&i&&i==this.currentPageId?(this.$callback(t),this._navigationManager&&(this._navigationManager.update(e),aria.utils.Json.setValue(this._data,"pageInfo",e))):(this._previousPageCSS=this._currentPageCSS,this._currentPageCSS=[],this._pageProvider.loadPageDefinition(e,{onsuccess:{fn:this._getPageDependencies,scope:this,args:{pageRequest:e,cb:t}},onfailure:{fn:this._errorCallback,scope:this,args:[this.PAGE_NOT_AVAILABLE,i],resIndex:-1}}))},_getPageDependencies:function(e,t){var i=this.isConfigValid(e,"aria.pageEngine.CfgBeans.PageDefinition",this.INVALID_PAGE_DEFINITION);if(!i)return this.$callback(t.cb),void 0;var s=new aria.pageEngine.utils.PageConfigHelper(e);aria.utils.Json.inject(s.getMenus(),this._siteConfigHelper.getAppData().menus),this._pageConfigHelper=s,this._lazyContent=!0,this._loadPageDependencies({lazy:!1,pageId:e.pageId,cb:{fn:this._displayPage,scope:this,args:{cb:t.cb,pageConfig:e,pageRequest:t.pageRequest}}})},_loadPageDependencies:function(e){var t=this._pageConfigHelper.getPageDependencies(e.lazy),i=this._siteConfigHelper.getCommonModulesDescription({priority:2,refpaths:t.modules.common});this._utils.wiseConcat(t.classes,this._utils.extractPropertyFromArrayElements(i,"classpath"));var s=this._pageConfigHelper.getPageModulesDescriptions(t.modules.page);this._currentPageCSS=this._currentPageCSS.concat(t.css),aria.utils.CSSLoader.add(t.css),delete t.css,t.oncomplete={scope:this,fn:this._loadPageModules,args:{pageId:e.pageId,cb:e.cb,subModules:{common:i,page:s}}},t.onerror={fn:this._errorCallback,scope:this,args:[this.MISSING_DEPENDENCIES],resIndex:-1},Aria.load(t)},_loadPageModules:function(e){var t=e.subModules;this._rootModule.loadModules(e.pageId,t,e.cb)},isConfigValid:function(e,t,i){try{aria.core.JsonValidator.normalize({json:e,beanName:t},!0)}catch(s){return this._utils.logMultipleErrors(i,s.errors,this),this._config.onerror&&this.$callback(this._config.onerror,i),!1}return!0},_displayPage:function(e){var t=e.pageConfig,i=t.pageComposition,s=t.pageId;this.currentPageId=s,this._pageConfigs[s]=t;var r=e.pageRequest;r.url=t.url,r.pageId=t.pageId,r.title=t.title;var a=aria.utils.Json;a.setValue(this._data,"pageData",i.pageData),a.setValue(this._data,"pageInfo",r);var n={classpath:i.template,div:this._getContainer(!1),moduleCtrl:this._rootModule};this._modulesInPage=[],!this._animationsManager&&this._isTemplateLoaded&&Aria.disposeTemplate(this._getContainer()),Aria.loadTemplate(n,{fn:this._afterTemplateLoaded,scope:this,args:{pageConfig:t,cb:e.cb,div:n.div,pageRequest:r}})},_afterTemplateLoaded:function(e,t){this._navigationManager&&this._navigationManager.update(t.pageRequest);var i=aria.core.Browser;i.isIE&&8>parseInt(i.majorVersion,10)&&aria.core.Timer.addCallback({fn:function(){t.div.style.zoom=0,t.div.style.zoom=1,t.div=null},scope:this,delay:0}),this._isTemplateLoaded=!0,this._animationsManager&&t.pageConfig.animation?(this._animationsManager.$on({animationend:{fn:this._pageTransitionComplete,args:t},scope:this}),this._animationsManager.startPageTransition(this._getContainer(!1),this._getContainer(),t.pageConfig.animation)):this._finishDisplay(t)},_pageTransitionComplete:function(e,t){this._animationsManager.$removeListeners({animationend:this._pageTransitionComplete,scope:this}),this._activeDiv=(this._activeDiv+1)%2,Aria.disposeTemplate(this._getContainer(!1)),this._finishDisplay(t)},_finishDisplay:function(e){aria.utils.CSSLoader.remove(this._previousPageCSS),this.$raiseEvent({name:"pageReady",pageId:e.pageConfig.pageId}),e.cb&&this.$callback(e.cb),this._loadPageDependencies({lazy:!0,pageId:e.pageConfig.pageId,cb:{fn:this._afterLazyDependenciesLoad,scope:this}})},_getContainer:function(e){return this._animationsManager?(e=!(e===!1),e?0===this._activeDiv?this._firstDiv:this._secondDiv:1===this._activeDiv?this._firstDiv:this._secondDiv):this._firstDiv},_afterLazyDependenciesLoad:function(){var e=this._pageConfigHelper.getLazyPlaceholdersIds();this._lazyContent=!1,this.$raiseEvent({name:"contentChange",contentPaths:e}),this._pageConfigHelper.$dispose()},getContent:function(e){var t,i=aria.utils.Type,s=this._pageConfigs[this.currentPageId],r=s.pageComposition.placeholders,a=r[e]||[],n=[];i.isArray(a)||(a=[a]);for(var o=0,l=a.length;l>o;o++){var c=a[o];i.isObject(c)?this._lazyContent&&c.lazy?n.push({loading:!0,width:c.lazy.width||null,height:c.lazy.height||null,color:c.lazy.color||null,innerHTML:c.lazy.innerHTML||null}):c.template?n.push(this._getTemplateCfg(c,s)):c.contentId&&(t=this._getPlaceholderContents(s,c.contentId),n=n.concat(t)):n.push(c)}return n},_getTemplateCfg:function(e,t){var i={classpath:e.template},s=e.args||[],r={};if(e.contentId&&(r.contents=this._getPlaceholderContents(t,e.contentId)),s.push(r),i.args=s,e.module){var a=this._rootModule.getPageModule(this.currentPageId,e.module);i.moduleCtrl=a,this._modulesInPage.push(a)}return i},_getPlaceholderContents:function(e,t){var i=[],s=e.contents.placeholderContents[t];if(!s)return i;aria.utils.Type.isArray(s)||(s=[s]);for(var r=0,a=s.length;a>r;r++)i=i.concat(this.processContent(s[r]));return i},processContent:function(e){var t=e.contentType;return t&&t in this.contentProcessors?this.processContent(this.contentProcessors[t].processContent(e)):e.value||""},_errorCallback:function(e){var t=this._config;this.$logError.apply(this,e),t.onerror&&this.$callback(t.onerror,e[0])},_onPageDefinitionChange:function(e){var t=e.pageId;this.currentPageId==t&&(this._rootModule.unloadPageModules(t),this.navigate({pageId:t,url:this._navigationManager?this._navigationManager.getUrl():null,forceReload:!0}))},getData:function(){return this._data},getPageProvider:function(){return this._pageProvider},isModuleInPage:function(e){return aria.utils.Array.contains(this._modulesInPage,e.$publicInterface())}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/contentProcessors/MarkdownProcessor.js
//*******************
(function(){var e={};e.converter=function(){var e,t,i,r=0;this.makeHtml=function(r){return e=[],t=[],i=[],r=r.replace(/~/g,"~T"),r=r.replace(/\$/g,"~D"),r=r.replace(/\r\n/g,"\n"),r=r.replace(/\r/g,"\n"),r="\n\n"+r+"\n\n",r=x(r),r=r.replace(/^[ \t]+$/gm,""),r=n(r),r=a(r),r=l(r),r=A(r),r=r.replace(/~D/g,"$$"),r=r.replace(/~T/g,"~")};var s,a=function(i){var i=i.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(i,r,s,a,n){return r=r.toLowerCase(),e[r]=w(s),a?a+n:(n&&(t[r]=n.replace(/"/g,"&quot;")),"")});return i},n=function(e){return e=e.replace(/\n/g,"\n\n"),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,o),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,o),e=e.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,o),e=e.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,o),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,o),e=e.replace(/\n\n/g,"\n")},o=function(e,t){var r=t;return r=r.replace(/\n\n/g,"\n"),r=r.replace(/^\n/,""),r=r.replace(/\n+$/g,""),r="\n\n~K"+(i.push(r)-1)+"K\n\n"},l=function(e){e=_(e);var t=y("<hr />");return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,t),e=g(e),e=m(e),e=b(e),e=n(e),e=C(e)},c=function(e){return e=v(e),e=h(e),e=T(e),e=d(e),e=u(e),e=S(e),e=w(e),e=E(e),e=e.replace(/  +\n/g," <br />\n")},h=function(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=M(t,"\\`*_")})},u=function(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,p)},p=function(i,r,s,a,n,o,l,c){void 0==c&&(c="");var h=r,u=s,p=a.toLowerCase(),d=n,f=c;if(""==d)if(""==p&&(p=u.toLowerCase().replace(/ ?\n/g," ")),d="#"+p,void 0!=e[p])d=e[p],void 0!=t[p]&&(f=t[p]);else{if(!(h.search(/\(\s*\)$/m)>-1))return h;d=""}d=M(d,"*_");var _='<a href="'+d+'"';return""!=f&&(f=f.replace(/"/g,"&quot;"),f=M(f,"*_"),_+=' title="'+f+'"'),_+=">"+u+"</a>"},d=function(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,f),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,f)},f=function(i,r,s,a,n,o,l,c){var h=r,u=s,p=a.toLowerCase(),d=n,f=c;if(f||(f=""),""==d){if(""==p&&(p=u.toLowerCase().replace(/ ?\n/g," ")),d="#"+p,void 0==e[p])return h;d=e[p],void 0!=t[p]&&(f=t[p])}u=u.replace(/"/g,"&quot;"),d=M(d,"*_");var _='<img src="'+d+'" alt="'+u+'"';return f=f.replace(/"/g,"&quot;"),f=M(f,"*_"),_+=' title="'+f+'"',_+=" />"},_=function(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return y("<h1>"+c(t)+"</h1>")}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return y("<h2>"+c(t)+"</h2>")}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,i){var r=t.length;return y("<h"+r+">"+c(i)+"</h"+r+">")})},g=function(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return r?e=e.replace(t,function(e,t,i){var r=t,a=i.search(/[*+-]/g)>-1?"ul":"ol";r=r.replace(/\n{2,}/g,"\n\n\n");var n=s(r);return n=n.replace(/\s+$/,""),n="<"+a+">"+n+"</"+a+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,i,r){var a=t,n=i,o=r.search(/[*+-]/g)>-1?"ul":"ol",n=n.replace(/\n{2,}/g,"\n\n\n"),l=s(n);return l=a+"<"+o+">\n"+l+"</"+o+">\n"})),e=e.replace(/~0/,"")};s=function(e){return r++,e=e.replace(/\n{2,}$/,"\n"),e+="~0",e=e.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(e,t,i,r,s){var a=s,n=t;return n||a.search(/\n{2,}/)>-1?a=l(D(a)):(a=g(D(a)),a=a.replace(/\n$/,""),a=c(a)),"<li>"+a+"</li>\n"}),e=e.replace(/~0/g,""),r--,e};var m=function(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,i){var r=t,s=i;return r=$(D(r)),r=x(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r="<pre><code>"+r+"\n</code></pre>",y(r)+s}),e=e.replace(/~0/,"")},y=function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(i.push(e)-1)+"K\n\n"},v=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,i,r){var s=r;return s=s.replace(/^([ \t]*)/g,""),s=s.replace(/[ \t]*$/g,""),s=$(s),t+"<code>"+s+"</code>"})},$=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=M(e,"*_{}[]\\",!1)},E=function(e){return e=e.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},b=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var i=t;return i=i.replace(/^[ \t]*>[ \t]?/gm,"~0"),i=i.replace(/~0/g,""),i=i.replace(/^[ \t]+$/gm,""),i=l(i),i=i.replace(/(^|\n)/g,"$1  "),i=i.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var i=t;return i=i.replace(/^  /gm,"~0"),i=i.replace(/~0/g,"")}),y("<blockquote>\n"+i+"\n</blockquote>")})},C=function(e){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var t=e.split(/\n{2,}/g),r=[],s=t.length,a=0;s>a;a++){var n=t[a];n.search(/~K(\d+)K/g)>=0?r.push(n):n.search(/\S/)>=0&&(n=c(n),n=n.replace(/^([ \t]*)/g,"<p>"),n+="</p>",r.push(n))}s=r.length;for(var a=0;s>a;a++)for(;r[a].search(/~K(\d+)K/)>=0;){var o=i[RegExp.$1];o=o.replace(/\$/g,"$$$$"),r[a]=r[a].replace(/~K\d+K/,o)}return r.join("\n\n")},w=function(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},T=function(e){return e=e.replace(/\\(\\)/g,R),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,R)},S=function(e){return e=e.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),e=e.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(e,t){return I(A(t))})},I=function(e){function t(e){var t="0123456789ABCDEF",i=e.charCodeAt(0);return t.charAt(i>>4)+t.charAt(15&i)}var i=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+t(e)+";"},function(e){return e}];return e="mailto:"+e,e=e.replace(/./g,function(e){if("@"==e)e=i[Math.floor(2*Math.random())](e);else if(":"!=e){var t=Math.random();e=t>.9?i[2](e):t>.45?i[1](e):i[0](e)}return e}),e='<a href="'+e+'">'+e+"</a>",e=e.replace(/">.+:/g,'">')},A=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var i=parseInt(t);return String.fromCharCode(i)})},D=function(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")},x=function(e){return e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"~A~B"),e=e.replace(/~B(.+?)~A/g,function(e,t){for(var i=t,r=4-i.length%4,s=0;r>s;s++)i+=" ";return i}),e=e.replace(/~A/g,"    "),e=e.replace(/~B/g,"")},M=function(e,t,i){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";i&&(r="\\\\"+r);var s=RegExp(r,"g");return e=e.replace(s,R)},R=function(e,t){var i=t.charCodeAt(0);return"~E"+i+"E"}},Aria.classDefinition({$classpath:"aria.pageEngine.contentProcessors.MarkdownProcessor",$extends:"aria.core.JsObject",$singleton:!0,$constructor:function(){this.__converter=new e.converter},$destructor:function(){this._converter=null},$prototype:{processContent:function(e){var t={value:this.__converter.makeHtml(e.value),contentType:"text/html"};return t}}})})();
//*******************
//LOGICAL-PATH:aria/pageEngine/pageProviders/PageProviderInterface.js
//*******************
Aria.interfaceDefinition({$classpath:"aria.pageEngine.pageProviders.PageProviderInterface",$events:{pageDefinitionChange:""},$interface:{loadSiteConfig:function(){},loadPageDefinition:function(){}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/pageProviders/BasePageProvider.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.pageProviders.BasePageProvider",$implements:["aria.pageEngine.pageProviders.PageProviderInterface"],$dependencies:["aria.core.DownloadMgr"],$constructor:function(e){this._config=e,this._basePageUrl=null,"cache"in e||(e.cache=!0),this._cache={},this._urlMap={pageIdToUrl:{},urlToPageId:{}}},$prototype:{loadSiteConfig:function(e){this._sendRequest(aria.core.DownloadMgr.resolveURL(this._config.siteConfigLocation),{callback:e},"site")},loadPageDefinition:function(e,t){e=e||{};var i=this._getPageId(e);e.pageId=i,this._updateUrlMap(e);var r=this._config.cache?this._retrieveFromCache(e):null;return r?(this.$callback(t.onsuccess,r),void 0):(this._basePageUrl=this._basePageUrl||aria.core.DownloadMgr.resolveURL(this._config.pageBaseLocation+"fake.json").replace(/fake\.json$/,""),this._sendRequest(this._basePageUrl+i+".json",{pageRequest:e,callback:t},"page"),void 0)},_sendRequest:function(e,t,i){aria.core.IO.asyncRequest({url:e,expectedResponseType:"json",callback:{fn:"page"==i?this._onPageSuccess:this._onSiteSuccess,scope:this,args:t,onerror:this._onFailure}})},_onSiteSuccess:function(e,t){this.$callback(t.callback.onsuccess,e.responseJSON)},_onPageSuccess:function(e,t){var i=t.callback,r=t.pageRequest,a=e.responseJSON;this._updateUrlMap(a);var s=this._getUrl(r);this._config.cache&&this._updateCache(a,{url:s}),a.url=s,this._updateUrlMap(a),this.$callback(i.onsuccess,a)},_onFailure:function(e,t){this.$callback(t.callback.onfailure)},_updateUrlMap:function(e){var t=e.pageId,i=e.url,r=this._urlMap;if(t&&i){r.pageIdToUrl[t]=i,r.urlToPageId[i]=t;var a=i.replace(/\/$/,"");r.urlToPageId[a]=t}},_retrieveFromCache:function(e){var t=this._getPageId(e);if(t&&this._cache[t]){var i=this._cache[t];return i.url=this._getUrl(e),i}return null},_getPageId:function(e){var t=this._urlMap.urlToPageId,i=e.pageId,r=e.url;if(i)return i;if(r){var a=t[r]||t[r+"/"]||t[r.replace(/\/$/,"")];if(a)return a}return this._config.homePageId},_getUrl:function(e){var t=this._urlMap.pageIdToUrl,i=e.pageId,r=e.url;return r?r:i&&t[i]?t[i]:"/"+i},_updateCache:function(e,t){var i=t.url,r=e.url;r&&(this._cache[r]=e),this._cache[e.pageId]=e,this._cache[i]=e}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/pageProviders/BasePageProviderBeans.js
//*******************
Aria.beanDefinitions({$package:"aria.pageEngine.pageProviders.BasePageProviderBeans",$namespaces:{json:"aria.core.JsonTypes"},$beans:{Config:{$type:"json:Object",$properties:{siteConfigLocation:{$type:"json:String",$mandatory:!0},pageBaseLocation:{$type:"json:String",$mandatory:!0},cache:{$type:"json:Boolean",$default:!0},homePageId:{$type:"json:String",$mandatory:!0}}}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/AnimationsManager.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.utils.AnimationsManager",$dependencies:["aria.utils.css.Animations"],$constructor:function(){this._syncCfg={waiting:0,toDispose:[]}},$destructor:function(){this._syncCfg=null},$events:{animationend:""},$prototype:{createHiddenDiv:function(e){var t=e.cloneNode(!0);return t.setAttribute("id",""),t.className=t.className+" xanimation-element",t.innerHTML="",e.parentNode.insertBefore(t,e.nextSibling),t},_start:function(e,t){var i=new aria.utils.css.Animations;this._syncCfg.toDispose.push(i),i.$on({animationend:{fn:this._animationComplete},scope:this}),e.reverse=t.reverse,i.start(t.name,e)},startPageTransition:function(e,t,i){if(i.animateOut&&i.animateIn&&i.animateIn==i.animateOut){var r={from:t,to:e};this._syncCfg.waiting+=1,this._start(r,this._mappingAnimations(i.animateOut))}else{if(i.animateOut){var r={from:t};this._syncCfg.waiting+=1,this._start(r,this._mappingAnimations(i.animateOut))}else-1===t.className.indexOf("xanimation-element")&&(t.className=t.className+" xanimation-element");if(i.animateIn){var r={to:e};this._syncCfg.waiting+=1,this._start(r,this._mappingAnimations(i.animateIn))}}},_mappingAnimations:function(e){var t,i;switch(e){case"slide left":t="slide",i=!1;break;case"slide right":t="slide",i=!0;break;case"slide up":t="slideup",i=!1;break;case"slide down":t="slidedown",i=!1;break;case"fade":t="fade",i=!1;break;case"fade reverse":t="fade",i=!0;break;case"pop":t="pop",i=!1;break;case"pop reverse":t="pop",i=!0;break;case"flip":t="flip",i=!1;break;case"flip reverse":t="flip",i=!0}return{name:t,reverse:i}},_animationComplete:function(){if(this._syncCfg.waiting-=1,0===this._syncCfg.waiting){for(var e,t=0;this._syncCfg.toDispose.length>t;t++)e=this._syncCfg.toDispose[t],e.$unregisterListeners(),e.$dispose();this.$raiseEvent("animationend")}}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/BaseNavigationManager.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.utils.BaseNavigationManager",$dependencies:["aria.storage.LocalStorage","aria.utils.Event"],$statics:{_STORAGE_KEY:"at_pe_navigation_cache",EXPIRATION_TIME:86400},$constructor:function(e){this._navigate=e||null,this._storage=new aria.storage.LocalStorage,this._saveCacheCB={fn:this._saveCache,scope:this},aria.utils.Event.addListener(Aria.$window,"unload",this._saveCacheCB),this._cache=this._storage.getItem(this._STORAGE_KEY)||{}},$destructor:function(){this._navigate=null,this._storage&&this._saveCache(),this._cache=null},$prototype:{getPageId:function(){var e=this._cache[this.getUrl()];return e?e.id:null},_saveCache:function(){this._storage&&(this._removeOldCache(),this._storage.setItem(this._STORAGE_KEY,this._cache),this._storage.$dispose(),this._storage=null),aria.utils.Event.removeListener(Aria.$window,"unload",this._saveCacheCB)},_removeOldCache:function(){var e=this._cache,t=(new Date).getTime()-1e3*this.EXPIRATION_TIME;for(var i in e)e.hasOwnProperty(i)&&t>e[i].age&&delete e[i]},_addInCache:function(e,t){this._cache[e]={id:t,age:(new Date).getTime()}}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/HashManager.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.utils.HashManager",$extends:"aria.pageEngine.utils.BaseNavigationManager",$dependencies:["aria.utils.HashManager"],$constructor:function(e){this.$BaseNavigationManager.constructor.call(this,e),this._hashManager=aria.utils.HashManager,this._onHashChangeCallback={fn:this._onHashChange,scope:this},this._hashManager.addCallback(this._onHashChangeCallback)},$destructor:function(){this._hashManager.removeCallback(this._onHashChangeCallback),this._onHashChangeCallback=null,this._hashManager=null,this.$BaseNavigationManager.$destructor.call(this)},$prototype:{_onHashChange:function(){var e=this.getUrl(),t=this._cache[e]?this._cache[e].id:null;t&&this._navigate&&this.$callback(this._navigate,{pageId:t,url:e})},update:function(e){var t=e.url;t&&(this._addInCache(t,e.pageId),this.getUrl()!=t&&this._hashManager.setHash(t))},getUrl:function(){return this._hashManager.getHashString()}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/HistoryManager.js
//*******************
Aria.classDefinition({$classpath:"aria.pageEngine.utils.HistoryManager",$extends:"aria.pageEngine.utils.BaseNavigationManager",$dependencies:["aria.utils.History"],$constructor:function(e){this.$BaseNavigationManager.constructor.call(this,e),this._history=aria.utils.History,this._history.isBackwardCompatible=!1,this._onPopStateCallback={fn:this._onPopState,scope:this},this._history.$addListeners({onpopstate:this._onPopStateCallback})},$destructor:function(){this._history.$removeListeners({onpopstate:this._onPopStateCallback}),this._onPopStateCallback=null,this._history=null,this.$BaseNavigationManager.$destructor.call(this)},$prototype:{_onPopState:function(){var e=this.getUrl(),t=this._cache[e]?this._cache[e].id:null;t&&this._navigate&&this.$callback(this._navigate,{pageId:t,url:e,title:this.getTitle()})},update:function(e){var t=e.url;t&&(this._addInCache(t,e.pageId),this.getUrl()!=t&&(e.replace?this._history.replaceState(e.data,e.title,t):this._history.pushState(e.data,e.title,t)))},getUrl:function(){var e=this._history.getUrl();return e==Aria.$window.location.href?"":e},getTitle:function(){return this._history.getTitle()}}});